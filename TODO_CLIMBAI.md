# ClimbAI BoulderVision - TODO

**Обновлено:** 2026-01-20
**Статус:** v3.1 - Все основные задачи выполнены!

---

## ВЫПОЛНЕНО (20 января 2026)

### 1. Визуализация (overlays.py) - ГОТОВО
- [x] `spider_metrics` - Паутинка метрик
- [x] `weight_load` - Нагрузка в КГ
- [x] `ideal_ghost` - Призрак-эталон (теперь с загрузкой из файла!)
- [x] `tension_zones` - Зажимы и риски
- [x] `speed_map` - Скорость движения
- [x] `full` - Полный анализ

### 2. Исправление падения - ГОТОВО
**Файл:** `app/analysis/fall_detector.py`
- [x] FallDetector v2.0 с различением падения и спрыгивания
- [x] `is_controlled_descent` - определяет контролируемый спуск
- [x] Анализ скорости, качества позы, баланса

### 3. Алгоритмическое описание - ГОТОВО
**Файл:** `app/analysis/algorithmic.py` (НОВЫЙ)
- [x] Генерация отчёта без AI
- [x] Качество пролаза, зажимы, прогноз травм
- [x] Рекомендации на основе данных

### 4. AI анализ с рекомендациями - ГОТОВО
**Файл:** `app/analysis/ai_recommendations.py` (НОВЫЙ)
- [x] База упражнений по категориям (баланс, сила, плечи, кор, гибкость)
- [x] База книг по скалолазанию
- [x] База экспертов и ресурсов
- [x] Интеграция с Claude для персональных советов
- [x] Генерация плана тренировок

### 5. Оптимизация призрака - ГОТОВО
**Файл:** `app/video/ghost_manager.py` (НОВЫЙ)
- [x] Извлечение landmarks из видео
- [x] Сохранение эталонов в JSON
- [x] Загрузка эталонов
- [x] Расчёт схожести
- [x] Интеграция с VideoOverlays

---

## КАК ЗАПУСТИТЬ БОТА

```bash
cd "/home/user/с винды/ClimbAI/telegram_bot_bouldervision"

# Проверить зависимости
python3 -c "import telegram; import anthropic; import mediapipe; print('OK')"

# Запустить бота
python3 run_bot.py

# Или через модуль
python3 -m app.main

# Логи
tail -f bot.log
```

---

## КАК ПРОДОЛЖИТЬ В CURSOR / CLAUDE CODE

Просто напиши:
```
продолжаем ClimbAI
```
И покажи этот файл.

---

## НОВЫЕ МОДУЛИ (созданы 20.01.2026)

| Файл | Описание |
|------|----------|
| `app/analysis/algorithmic.py` | Алгоритмический анализ без AI |
| `app/analysis/ai_recommendations.py` | AI рекомендации с упражнениями, книгами, экспертами |
| `app/video/ghost_manager.py` | Управление эталонными видео (призраками) |

---

## ИСПРАВЛЕНО (20 января 2026)

### Исправления визуализации
- [x] Исправлено отображение метрик в паутинке - убраны вопросики, правильно вычисляются значения
- [x] Исправлено форматирование нагрузки - теперь показывает % от веса (25,5% вместо 25,5?????)
- [x] Исправлена стрелка скорости - правильный расчет угла и отрисовка (убраны странные стрелки часов)
- [x] Восстановлен полный анализ - скелетик, паутина и все метрики работают корректно
- [x] Добавлена валидация всех метрик - проверка на None и NaN значения

**Файл:** `app/video/overlays.py`
- Исправлены функции: `draw_spider_metrics`, `draw_weight_load`, `draw_speed_map`, `draw_full_analysis`
- Добавлена валидация в `_calculate_current_metrics`, `_draw_mini_spider`, `_draw_weight_labels`

## СЛЕДУЮЩИЕ ЗАДАЧИ

- [ ] Добавить команду /ghost для загрузки эталонного видео
- [ ] Добавить команду /saveghost для сохранения лучшей попытки
- [ ] Интегрировать GhostManager в обработчики бота (кнопка выбора эталона)
- [ ] Реальное тестирование с видео скалолазания
- [ ] Добавить отображение схожести с эталоном в процентах
- [ ] Улучшить алгоритмический анализ: предиктивная аналитика зажимов и рисков травм
- [ ] Реализовать HR main box: навыки, потенциал, физические возможности, психологическое состояние
- [ ] Определение трассы: анализ сложности (разминка vs сложная трасса)
- [ ] Отрисовка на видео: тепловая карта, зажимы, скелетик
- [ ] Графики в PDF или веб-интерфейсе
- [ ] Сайт с админкой для видео и истории тренировок

---

## СТРУКТУРА ПРОЕКТА

```
telegram_bot_bouldervision/
├── app/
│   ├── analysis/
│   │   ├── algorithmic.py        # NEW: Алгоритмический анализ
│   │   ├── ai_recommendations.py # NEW: AI рекомендации
│   │   ├── fall_detector.py      # UPDATED: v2.0 падение vs спрыгивание
│   │   ├── tension_analyzer.py
│   │   ├── injury_predictor.py
│   │   └── nine_box_model.py
│   ├── video/
│   │   ├── ghost_manager.py      # NEW: Управление эталонами
│   │   ├── overlays.py           # UPDATED: load_ghost_from_file()
│   │   └── processor.py
│   ├── bot/
│   │   ├── handlers.py
│   │   ├── keyboards.py
│   │   └── messages.py
│   ├── reports/
│   │   └── generator.py          # UPDATED: AI рекомендации
│   └── main.py
├── data/
│   └── ghosts/                   # Директория для эталонов
├── .env                          # API ключи
└── TODO_CLIMBAI.md               # ЭТА ЗАМЕТКА
```

---

## API КЛЮЧИ (в .env)

```
TELEGRAM_BOT_TOKEN=твой_токен
ANTHROPIC_API_KEY=твой_ключ
```

---

## ПРИНЦИПЫ (из "Переломного момента")

1. **Закон малых чисел** - только 5 ключевых визуализаций
2. **Сила контекста** - подсказки когда использовать каждую
3. **Приклеиваемость** - классные визуализации для соцсетей
